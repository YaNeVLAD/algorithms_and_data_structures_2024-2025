/*--------------------------------------------------------------------------------------------------
	Задание: В файле заданы N упорядоченных по  возрастанию  списков
	целых чисел. Организовать  в  оперативной  памяти  с  помощью
	указателей N линейных списков и слить их в общий список. (8)
   
	Автор: Ковалев Владислав ПС-21
	Среда выполнения: Visual Studio 2022
*//*------------------------------------------------------------------------------------------------
	В файле n строк, в которых числа отсортированы по возрастанию.
	Длинна строк может быть разной, но чиста в них всегда отсортированы в порядке возрастания.
	Нужно из каждой строки организовать связный список.
	Далее сортировкой слиянием нужно вывести упорядоченную последовательность чисел всего файла.
	Алгоритм:
	1) сравниваем каждую строку с каждой
	2) находим минимальный первый элемент из всех строк
	3) записываем его
	4) в строке, в который мы нашли этот символ смещаемся на 1 шаг
	5) повторять до победного (пока все числа не кончатся)
--------------------------------------------------------------------------------------------------*/

#include "lab2.h"

#include <windows.h>
#include <iostream>
#include <fstream>
#include <conio.h>

#include <chrono>

using namespace std;

enum MenuOptions {
	CREATE_FILE = 1,
	SELECT_FILE,
	ADD_TO_FILE,
	SHOW_FILE,
	SORT,
	EXIT
};

enum KeyCodes {
	ENTER = 13,
	ARROW_UP = 72,
	ARROW_DOWN = 80,
	ARROW_LEFT = 75,
	ARROW_RIGHT = 77,
	SPECIAL_CODE = 224,
};

void setCursorPosition(int x, int y);
void renderMenu(int selectedOption);
void updateMenuSelection(int previousOption, int currentOption);

int linkedListsMerge()
{
	int selectedOption = 1;
	int previousOption = 1;

	SetConsoleCP(1251);
	SetConsoleOutputCP(1251);

	setlocale(LC_ALL, "Russian");

	system("cls");
	renderMenu(selectedOption);

	while (true)
	{
		int key = _getch();
		if (key == SPECIAL_CODE)
		{
			key = _getch();
			if (key == ARROW_UP || key == ARROW_RIGHT)
			{
				if (selectedOption > CREATE_FILE)
				{
					previousOption = selectedOption;
					selectedOption--;
				}
				else
				{
					previousOption = selectedOption;
					selectedOption = EXIT;
				}
			}
			if (key == ARROW_DOWN || key == ARROW_LEFT)
			{
				if (selectedOption < EXIT)
				{
					previousOption = selectedOption;
					selectedOption++;
				}
				else
				{
					previousOption = selectedOption;
					selectedOption = CREATE_FILE;
				}
			}
		}
		if (key == ENTER) {
			switch (selectedOption)
			{
			case CREATE_FILE: break;
			case SELECT_FILE: break;
			case ADD_TO_FILE: break;
			case SHOW_FILE: break;
			case SORT: break;
			case EXIT: return EXIT_SUCCESS; break;
			default:
				break;
			}
		}
		updateMenuSelection(previousOption, selectedOption);
	}

	return EXIT_SUCCESS;
}

void setCursorPosition(int x, int y)
{
	COORD coord{};
	coord.X = x;
	coord.Y = y;
	SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), coord);
}

void updateMenuSelection(int previousOption, int currentOption)
{
	setCursorPosition(0, previousOption);
	cout << "  ";

	setCursorPosition(0, currentOption);
	cout << "->";
}

void renderMenu(int selectedOption)
{
	cout << "==== [Сортировка в порядке возрастания чисел в файле] ====" << std::endl;
	cout << "  1. Создать входной файл" << std::endl;
	cout << "  2. Указать входной файл" << std::endl;
	cout << "  3. Добавить список в файл" << std::endl;
	cout << "  5. Показать содержимое файла" << std::endl;
	cout << "  7. Сортировка файла" << std::endl;
	cout << "  8. Выход" << std::endl;

	setCursorPosition(0, selectedOption);
	cout << "->";
}